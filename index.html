<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Download MP4</title>
  </head>
  <body>
    <h1>Download YouTube Video</h1>

    <form id="downloadForm">
      <label for="videoUrl">YouTube Video URL:</label>
      <input type="text" id="videoUrl" name="videoUrl" required />
      <button type="submit">Download Info</button>
    </form>

    <h2 id="title"></h2>
    <p id="status"></p>

    <div id="downloadOptions" style="display: none">
      <h3>Download Links:</h3>
      <p>
        <a id="lowQuality" href="" target="_blank" download
          >Low Quality (MP4)</a
        >
      </p>
      <p>
        <a id="highQuality" href="" target="_blank" download
          >High Quality (MP4)</a
        >
      </p>
    </div>

    <!-- Section to display the whole response -->
    <h3>Server Response:</h3>
    <pre id="responseJson"></pre>

    <script>
      document
        .getElementById("downloadForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const videoUrl = document.getElementById("videoUrl").value;
          const statusElement = document.getElementById("status");
          const downloadOptions = document.getElementById("downloadOptions");
          const titleElement = document.getElementById("title");
          const lowQualityLink = document.getElementById("lowQuality");
          const highQualityLink = document.getElementById("highQuality");
          const responseJsonElement = document.getElementById("responseJson");

          statusElement.textContent = "Fetching download links...";
          downloadOptions.style.display = "none"; // Hide the download options initially
          titleElement.textContent = "";
          responseJsonElement.textContent = ""; // Clear previous response

          try {
            const response = await fetch("https://download-video-9r4a.onrender.com/downloadmp4", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                data: {
                  url: videoUrl,
                },
              }),
            });

            if (response.ok) {
              const result = await response.json(); // Parse response as JSON

              // Display the title and dynamically set download links
              titleElement.textContent = result.title || "Video";
              lowQualityLink.href = result.low || "#"; // Set dynamically
              highQualityLink.href = result.high || "#"; // Set dynamically

              if (result.low && result.high) {
                statusElement.textContent = "Download ready:";
                downloadOptions.style.display = "block"; // Show the download options
              } else {
                statusElement.textContent =
                  "Could not fetch all download links.";
              }

              // Display the full response as a formatted JSON string
              responseJsonElement.textContent = JSON.stringify(result, null, 2);
            } else {
              statusElement.textContent = "Failed to fetch video details";
              console.error("Error:", await response.text());
            }
          } catch (error) {
            statusElement.textContent =
              "Error occurred while fetching video info";
            console.error("Error:", error);
          }
        });
    </script>
  </body>
</html>
